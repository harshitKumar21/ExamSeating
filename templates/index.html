<!DOCTYPE html>
<html>
<head>
  <title>Exam Seating</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">

<h1 class="text-3xl font-bold text-center mb-6">
  ðŸŽ“ University Exam Seating
</h1>

{% if stage == "upload" %}
<form action="/prepare" method="post" enctype="multipart/form-data"
      class="bg-white p-6 max-w-md mx-auto rounded shadow">
  <input type="file" name="file" required class="mb-4">
  <button class="bg-blue-600 text-white px-4 py-2 rounded w-full">
    Upload CSV
  </button>
</form>
{% endif %}

{% if stage == "colors" %}
<form action="/generate" method="post"
      class="bg-white p-6 max-w-lg mx-auto rounded shadow">
  <h2 class="font-bold mb-4">Choose Colors</h2>
  {% for s in subjects %}
    <div class="flex justify-between mb-2">
      <span>{{ s }}</span>
      <input type="color" name="color_{{ s }}" value="{{ colors[s] }}">
    </div>
  {% endfor %}
  <button class="bg-green-600 text-white px-4 py-2 rounded w-full mt-4">
    Generate Seating
  </button>
</form>
{% endif %}

{% if stage == "result" %}
<div class="mb-4 font-bold">
  Overall Filled: {{ global_filled }} / {{ global_capacity }}
</div>

{% for hall, cfg in halls.items() %}
  <div class="bg-white p-4 mb-6 rounded shadow">
    <h2 class="font-bold mb-2">
      {{ hall }} ({{ plans[hall].filled }}/{{ plans[hall].capacity }})
    </h2>

    <table class="border-collapse w-full text-sm">
      {% for r in range(plans[hall].rows) %}
      <tr>
        {% for c in range(plans[hall].cols) %}
          {% set s = plans[hall].seating.get((r,c)) %}
          {% if s %}
          <td class="border p-2 text-white text-center"
              style="background: {{ colors[s.subject] }}">
            <div class="font-bold">{{ s.roll_no }}</div>
            <div class="text-xs">{{ s.name }}</div>
            <div class="text-xs">{{ s.subject }}</div>
          </td>
          {% else %}
          <td class="border p-2 text-center text-gray-400">Empty</td>
          {% endif %}
        {% endfor %}
      </tr>
      {% endfor %}
    </table>
  </div>
{% endfor %}

<div class="flex gap-4">
  <a href="/download/csv" class="bg-blue-600 text-white px-4 py-2 rounded">CSV</a>
  <a href="/" class="bg-gray-600 text-white px-4 py-2 rounded">Start Over</a>
</div>
{% endif %}

</body>
</html>
